<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Tilt::Template</title>

	<link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

	<script src="../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../lib/tilt/template_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/tilt/template.rb">lib/tilt/template.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">Object</p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#M000112">::cached_evaluate</a></li>
					
					<li><a href="#M000102">::new</a></li>
					
					<li><a href="#M000104">#basename</a></li>
					
					<li><a href="#M000111">#cached_evaluate</a></li>
					
					<li><a href="#M000123">#compile_template_method</a></li>
					
					<li><a href="#M000120">#compile_template_method</a></li>
					
					<li><a href="#M000117">#compiled_method</a></li>
					
					<li><a href="#M000106">#eval_file</a></li>
					
					<li><a href="#M000110">#evaluate</a></li>
					
					<li><a href="#M000118">#evaluate_source</a></li>
					
					<li><a href="#M000119">#evaluate_source</a></li>
					
					<li><a href="#M000122">#extract_magic_comment</a></li>
					
					<li><a href="#M000107">#initialize_engine</a></li>
					
					<li><a href="#M000105">#name</a></li>
					
					<li><a href="#M000113">#precompiled</a></li>
					
					<li><a href="#M000116">#precompiled_postamble</a></li>
					
					<li><a href="#M000115">#precompiled_preamble</a></li>
					
					<li><a href="#M000114">#precompiled_template</a></li>
					
					<li><a href="#M000109">#prepare</a></li>
					
					<li><a href="#M000103">#render</a></li>
					
					<li><a href="#M000108">#require_template_library</a></li>
					
					<li><a href="#M000121">#unbind_compiled_method</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
		</div>

		<div id="project-metadata">
			
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../Tilt.html">Tilt</a></li>
				
					<li><a href="../Tilt/BlueClothTemplate.html">Tilt::BlueClothTemplate</a></li>
				
					<li><a href="../Tilt/BuilderTemplate.html">Tilt::BuilderTemplate</a></li>
				
					<li><a href="../Tilt/Cache.html">Tilt::Cache</a></li>
				
					<li><a href="../Tilt/CoffeeScriptTemplate.html">Tilt::CoffeeScriptTemplate</a></li>
				
					<li><a href="../Tilt/CompileSite.html">Tilt::CompileSite</a></li>
				
					<li><a href="../Tilt/CreoleTemplate.html">Tilt::CreoleTemplate</a></li>
				
					<li><a href="../Tilt/ERBTemplate.html">Tilt::ERBTemplate</a></li>
				
					<li><a href="../Tilt/ErubisTemplate.html">Tilt::ErubisTemplate</a></li>
				
					<li><a href="../Tilt/HamlTemplate.html">Tilt::HamlTemplate</a></li>
				
					<li><a href="../Tilt/KramdownTemplate.html">Tilt::KramdownTemplate</a></li>
				
					<li><a href="../Tilt/LessTemplate.html">Tilt::LessTemplate</a></li>
				
					<li><a href="../Tilt/LiquidTemplate.html">Tilt::LiquidTemplate</a></li>
				
					<li><a href="../Tilt/MarkabyTemplate.html">Tilt::MarkabyTemplate</a></li>
				
					<li><a href="../Tilt/MarkabyTemplate/builder;.html">Tilt::MarkabyTemplate::builder;</a></li>
				
					<li><a href="../Tilt/MarukuTemplate.html">Tilt::MarukuTemplate</a></li>
				
					<li><a href="../Tilt/NokogiriTemplate.html">Tilt::NokogiriTemplate</a></li>
				
					<li><a href="../Tilt/RDiscountTemplate.html">Tilt::RDiscountTemplate</a></li>
				
					<li><a href="../Tilt/RDocTemplate.html">Tilt::RDocTemplate</a></li>
				
					<li><a href="../Tilt/RadiusTemplate.html">Tilt::RadiusTemplate</a></li>
				
					<li><a href="../Tilt/RedClothTemplate.html">Tilt::RedClothTemplate</a></li>
				
					<li><a href="../Tilt/RedcarpetTemplate.html">Tilt::RedcarpetTemplate</a></li>
				
					<li><a href="../Tilt/SassTemplate.html">Tilt::SassTemplate</a></li>
				
					<li><a href="../Tilt/ScssTemplate.html">Tilt::ScssTemplate</a></li>
				
					<li><a href="../Tilt/StringTemplate.html">Tilt::StringTemplate</a></li>
				
					<li><a href="../Tilt/Template.html">Tilt::Template</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Tilt::Template</h1>

		<div id="description">
			<p>
Base class for template implementations. Subclasses must implement the <a
href="Template.html#M000109">prepare</a> method and one of the <a
href="Template.html#M000110">evaluate</a> or <a
href="Template.html#M000114">precompiled_template</a> methods.
</p>

		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		
		<div id="attribute-method-details" class="method-section section">
			<h3 class="section-header">Attributes</h3>

			
			<div id="data-attribute-method" class="method-detail">
				<a name="data"></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">data</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description">
				
				<p>
<a href="Template.html">Template</a> source; loaded from a file or given
directly.
</p>
				
				</div>
			</div>
			
			<div id="file-attribute-method" class="method-detail">
				<a name="file"></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">file</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description">
				
				<p>
The name of the file where the template data was loaded from.
</p>
				
				</div>
			</div>
			
			<div id="line-attribute-method" class="method-detail">
				<a name="line"></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">line</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description">
				
				<p>
The line number in <a href="Template.html#file">file</a> where template
data was loaded from.
</p>
				
				</div>
			</div>
			
			<div id="options-attribute-method" class="method-detail">
				<a name="options"></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">options</span><span
						class="attribute-access-type">[R]</span>
				</div>

				<div class="method-description">
				
				<p>
A Hash of template engine specific options. This is passed directly to the
underlying engine and is not used by the generic template interface.
</p>
				
				</div>
			</div>
			
			<div id="engine-initialized-attribute-method" class="method-detail">
				<a name="engine_initialized"></a>
				
				<a name="engine_initialized="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">engine_initialized</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
			<div id="default-mime-type-attribute-method" class="method-detail">
				<a name="default_mime_type"></a>
				
				<a name="default_mime_type="></a>
				
				<div class="method-heading attribute-method-heading">
					<span class="method-name">default_mime_type</span><span
						class="attribute-access-type">[RW]</span>
				</div>

				<div class="method-description">
				
				
				
				</div>
			</div>
			
		</div>
		

		<!-- Methods -->
		
		<div id="private-instance-method-details" class="method-section section">
			<h3 class="section-header">Private Instance Methods</h3>

		
			<div id="compile-template-method-method" class="method-detail ">
				<a name="M000123"></a>

				<div class="method-heading">
				
					<span class="method-name">compile_template_method</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="compile-template-method-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 270</span>
270:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals</span>)
271:         <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
272:         <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
273:         <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;__tilt_#{Thread.current.object_id}&quot;</span>
274:         <span class="ruby-constant">Object</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-value str">          TOPOBJECT.class_eval do            def #{method_name}(locals)              #{source}            end          end</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>
275:         <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
276:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="compile-template-method-method" class="method-detail ">
				<a name="M000120"></a>

				<div class="method-heading">
				
					<span class="method-name">compile_template_method</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="compile-template-method-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals</span>)
230:       <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
231:       <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-value">5</span>
232:       <span class="ruby-identifier">method_name</span> = <span class="ruby-node">&quot;__tilt_#{Thread.current.object_id.abs}&quot;</span>
233:       <span class="ruby-constant">Object</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-value str">        #{extract_magic_comment source}        TOPOBJECT.class_eval do          def #{method_name}(locals)            Thread.current[:tilt_vars] = [self, locals]            class &lt;&lt; self              this, locals = Thread.current[:tilt_vars]              this.instance_eval do               #{source}              end            end          end        end</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>
234:       <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
235:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="evaluate-source-method" class="method-detail ">
				<a name="M000118"></a>

				<div class="method-heading">
				
					<span class="method-name">evaluate_source</span><span
						class="method-args">(scope, locals, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Evaluate the template source in the context of the scope object.
</p>
					

					
					<div class="method-source-code"
						id="evaluate-source-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 207</span>
207:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
208:       <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
209:       <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">eval_file</span>, <span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>)
210:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="evaluate-source-method" class="method-detail ">
				<a name="M000119"></a>

				<div class="method-heading">
				
					<span class="method-name">evaluate_source</span><span
						class="method-args">(scope, locals, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="evaluate-source-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 222</span>
222:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
223:         <span class="ruby-identifier">source</span>, <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
224:         <span class="ruby-identifier">file</span>, <span class="ruby-identifier">lineno</span> = <span class="ruby-identifier">eval_file</span>, (<span class="ruby-identifier">line</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">offset</span>)
225:         <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">instance_eval</span> { <span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">eval</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">binding</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">lineno</span>) }
226:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="extract-magic-comment-method" class="method-detail ">
				<a name="M000122"></a>

				<div class="method-heading">
				
					<span class="method-name">extract_magic_comment</span><span
						class="method-args">(script)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="extract-magic-comment-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 256</span>
256:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extract_magic_comment</span>(<span class="ruby-identifier">script</span>)
257:       <span class="ruby-identifier">comment</span> = <span class="ruby-identifier">script</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-regexp re">/\A[ \t]*\#.*coding\s*[=:]\s*([[:alnum:]\-_]+).*$/</span>)
258:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">comment</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-node">]ascii-8bit binary]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">$1</span>.<span class="ruby-identifier">downcase</span>)
259:       <span class="ruby-node">&quot;# coding: #{@default_encoding}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@default_encoding</span>
260:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="unbind-compiled-method-method" class="method-detail ">
				<a name="M000121"></a>

				<div class="method-heading">
				
					<span class="method-name">unbind_compiled_method</span><span
						class="method-args">(method_name)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="unbind-compiled-method-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 250</span>
250:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unbind_compiled_method</span>(<span class="ruby-identifier">method_name</span>)
251:       <span class="ruby-identifier">method</span> = <span class="ruby-constant">TOPOBJECT</span>.<span class="ruby-identifier">instance_method</span>(<span class="ruby-identifier">method_name</span>)
252:       <span class="ruby-constant">TOPOBJECT</span>.<span class="ruby-identifier">class_eval</span> { <span class="ruby-identifier">remove_method</span>(<span class="ruby-identifier">method_name</span>) }
253:       <span class="ruby-identifier">method</span>
254:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="basename-method" class="method-detail ">
				<a name="M000104"></a>

				<div class="method-heading">
				
					<span class="method-name">basename</span><span
						class="method-args">(suffix='')</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
The basename of the template file.
</p>
					

					
					<div class="method-source-code"
						id="basename-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 80</span>
80:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">basename</span>(<span class="ruby-identifier">suffix</span>=<span class="ruby-value str">''</span>)
81:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">suffix</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>
82:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="eval-file-method" class="method-detail ">
				<a name="M000106"></a>

				<div class="method-heading">
				
					<span class="method-name">eval_file</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
The filename used in backtraces to describe the template.
</p>
					

					
					<div class="method-source-code"
						id="eval-file-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 90</span>
90:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">eval_file</span>
91:       <span class="ruby-identifier">file</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'(__TEMPLATE__)'</span>
92:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="name-method" class="method-detail ">
				<a name="M000105"></a>

				<div class="method-heading">
				
					<span class="method-name">name</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
The template file&#8217;s basename with all extensions chomped off.
</p>
					

					
					<div class="method-source-code"
						id="name-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">name</span>
86:       <span class="ruby-identifier">basename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'.'</span>, <span class="ruby-value">2</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">basename</span>
87:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="render-method" class="method-detail ">
				<a name="M000103"></a>

				<div class="method-heading">
				
					<span class="method-name">render</span><span
						class="method-args">(scope=Object.new, locals={}, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Render the template in the given scope with the locals specified. If a
block is given, it is typically available within the template via
<tt>yield</tt>.
</p>
					

					
					<div class="method-source-code"
						id="render-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 75</span>
75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>(<span class="ruby-identifier">scope</span>=<span class="ruby-constant">Object</span>.<span class="ruby-identifier">new</span>, <span class="ruby-identifier">locals</span>={}, &amp;<span class="ruby-identifier">block</span>)
76:       <span class="ruby-identifier">evaluate</span> <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span> <span class="ruby-operator">||</span> {}, &amp;<span class="ruby-identifier">block</span>
77:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="protected-instance-method-details" class="method-section section">
			<h3 class="section-header">Protected Instance Methods</h3>

		
			<div id="cached-evaluate-method" class="method-detail ">
				<a name="M000111"></a>

				<div class="method-heading">
				
					<span class="method-name">cached_evaluate</span><span
						class="method-args">(scope, locals, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Process the template and return the result. The first time this method is
called, the template source is evaluated with instance_eval. On the
sequential method calls it will compile the template to an unbound method
which will lead to better performance. In any case, template executation is
guaranteed to be performed in the scope object with the locals specified
and with support for yielding to the block.
</p>
					

					
					<div class="method-source-code"
						id="cached-evaluate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 136</span>
136:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
137:       <span class="ruby-comment cmt"># Redefine itself to use method compilation the next time:</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span>
142: 
143:       <span class="ruby-comment cmt"># Use instance_eval the first time:</span>
144:       <span class="ruby-identifier">evaluate_source</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
145:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="compiled-method-method" class="method-detail ">
				<a name="M000117"></a>

				<div class="method-heading">
				
					<span class="method-name">compiled_method</span><span
						class="method-args">(locals_keys)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
The compiled method for the locals keys provided.
</p>
					

					
					<div class="method-source-code"
						id="compiled-method-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 200</span>
200:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals_keys</span>)
201:       <span class="ruby-ivar">@compiled_method</span>[<span class="ruby-identifier">locals_keys</span>] <span class="ruby-operator">||=</span>
202:         <span class="ruby-identifier">compile_template_method</span>(<span class="ruby-identifier">locals_keys</span>)
203:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="evaluate-method" class="method-detail ">
				<a name="M000110"></a>

				<div class="method-heading">
				
					<span class="method-name">evaluate</span><span
						class="method-args">(scope, locals, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					
					

					
					<div class="method-source-code"
						id="evaluate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 126</span>
126:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
127:       <span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
128:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="initialize-engine-method" class="method-detail ">
				<a name="M000107"></a>

				<div class="method-heading">
				
					<span class="method-name">initialize_engine</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Called once and only once for each template subclass the first time the
template class is initialized. This should be used to require the
underlying template library and perform any initial setup.
</p>
					

					
					<div class="method-source-code"
						id="initialize-engine-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 98</span>
98:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize_engine</span>
99:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="precompiled-method" class="method-detail ">
				<a name="M000113"></a>

				<div class="method-heading">
				
					<span class="method-name">precompiled</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Generates all template source by combining the preamble, template, and
postamble and returns a two-tuple of the form: [source, offset], where
source is the string containing (Ruby) source code for the template and
offset is the integer line offset where line reporting should begin.
</p>
<p>
<a href="Template.html">Template</a> subclasses may override this method
when they need complete control over source generation or want to adjust
the default line offset. In most cases, overriding the <a
href="Template.html#M000114">precompiled_template</a> method is easier and
more appropriate.
</p>
					

					
					<div class="method-source-code"
						id="precompiled-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 156</span>
156:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled</span>(<span class="ruby-identifier">locals</span>)
157:       <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
158:       <span class="ruby-identifier">template</span> = <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
159:       <span class="ruby-identifier">magic_comment</span> = <span class="ruby-identifier">extract_magic_comment</span>(<span class="ruby-identifier">template</span>)
160:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">magic_comment</span>
161:         <span class="ruby-comment cmt"># Magic comment e.g. &quot;# coding: utf-8&quot; has to be in the first line.</span>
162:         <span class="ruby-comment cmt"># So we copy the magic comment to the first line.</span>
163:         <span class="ruby-identifier">preamble</span> = <span class="ruby-identifier">magic_comment</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;\n&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">preamble</span>
164:       <span class="ruby-keyword kw">end</span>
165:       <span class="ruby-identifier">parts</span> = [
166:         <span class="ruby-identifier">preamble</span>,
167:         <span class="ruby-identifier">template</span>,
168:         <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
169:       ]
170:       [<span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>), <span class="ruby-identifier">preamble</span>.<span class="ruby-identifier">count</span>(<span class="ruby-value str">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>]
171:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="precompiled-postamble-method" class="method-detail ">
				<a name="M000116"></a>

				<div class="method-heading">
				
					<span class="method-name">precompiled_postamble</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Generates postamble code for the precompiled template source. The string
returned from this method is appended to the precompiled template source.
</p>
					

					
					<div class="method-source-code"
						id="precompiled-postamble-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 195</span>
195:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_postamble</span>(<span class="ruby-identifier">locals</span>)
196:       <span class="ruby-value str">''</span>
197:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="precompiled-preamble-method" class="method-detail ">
				<a name="M000115"></a>

				<div class="method-heading">
				
					<span class="method-name">precompiled_preamble</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Generates preamble code for initializing template state, and performing
locals assignment. The default implementation performs locals assignment
only. Lines included in the preamble are subtracted from the source line
offset, so adding code to the preamble does not effect line reporting in
Kernel::caller and backtraces.
</p>
					

					
					<div class="method-source-code"
						id="precompiled-preamble-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 188</span>
188:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_preamble</span>(<span class="ruby-identifier">locals</span>)
189:       <span class="ruby-identifier">locals</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k} = locals[#{k.inspect}]&quot;</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
190:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="precompiled-template-method" class="method-detail ">
				<a name="M000114"></a>

				<div class="method-heading">
				
					<span class="method-name">precompiled_template</span><span
						class="method-args">(locals)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
A string containing the (Ruby) source code for the template. The default <a
href="Template.html#M000110">Template#evaluate</a> implementation requires
either this method or the <a href="Template.html#M000113">precompiled</a>
method be overridden. When defined, the base <a
href="Template.html">Template</a> guarantees correct file/line handling,
locals support, custom scopes, and support for template compilation when
the scope object allows it.
</p>
					

					
					<div class="method-source-code"
						id="precompiled-template-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 179</span>
179:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">precompiled_template</span>(<span class="ruby-identifier">locals</span>)
180:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
181:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="prepare-method" class="method-detail ">
				<a name="M000109"></a>

				<div class="method-heading">
				
					<span class="method-name">prepare</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Do whatever preparation is necessary to setup the underlying template
engine. Called immediately after template data is loaded. Instance
variables set in this method are available when <a
href="Template.html#M000110">evaluate</a> is called.
</p>
<p>
Subclasses must provide an implementation of this method.
</p>
					

					
					<div class="method-source-code"
						id="prepare-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 116</span>
116:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare</span>
117:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:compile!</span>)
118:         <span class="ruby-comment cmt"># backward compat with tilt &lt; 0.6; just in case</span>
119:         <span class="ruby-identifier">warn</span> <span class="ruby-value str">'Tilt::Template#compile! is deprecated; implement #prepare instead.'</span>
120:         <span class="ruby-identifier">compile!</span>
121:       <span class="ruby-keyword kw">else</span>
122:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
123:       <span class="ruby-keyword kw">end</span>
124:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="require-template-library-method" class="method-detail ">
				<a name="M000108"></a>

				<div class="method-heading">
				
					<span class="method-name">require_template_library</span><span
						class="method-args">(name)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Like Kernel::require but issues a warning urging a manual require when
running under a threaded environment.
</p>
					

					
					<div class="method-source-code"
						id="require-template-library-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">require_template_library</span>(<span class="ruby-identifier">name</span>)
104:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">list</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
105:         <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;WARN: tilt autoloading '#{name}' in a non thread-safe way; &quot;</span> <span class="ruby-operator">+</span>
106:              <span class="ruby-node">&quot;explicit require '#{name}' suggested.&quot;</span>
107:       <span class="ruby-keyword kw">end</span>
108:       <span class="ruby-identifier">require</span> <span class="ruby-identifier">name</span>
109:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="new-method" class="method-detail ">
				<a name="M000102"></a>

				<div class="method-heading">
				
					<span class="method-name">new</span><span
						class="method-args">(file=nil, line=1, options={}, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Create a new template with the file, line, and options specified. By
default, template data is read from the file. When a block is given, it
should read template data and return as a String. When file is nil, a block
is required.
</p>
<p>
All arguments are optional.
</p>
					

					
					<div class="method-source-code"
						id="new-source">
<pre>
    <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 38</span>
38:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">file</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">line</span>=<span class="ruby-value">1</span>, <span class="ruby-identifier">options</span>={}, &amp;<span class="ruby-identifier">block</span>)
39:       <span class="ruby-ivar">@file</span>, <span class="ruby-ivar">@line</span>, <span class="ruby-ivar">@options</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>, {}
40: 
41:       [<span class="ruby-identifier">options</span>, <span class="ruby-identifier">line</span>, <span class="ruby-identifier">file</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
42:         <span class="ruby-keyword kw">case</span>
43:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_str</span>)  ; <span class="ruby-ivar">@file</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_str</span>
44:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_int</span>)  ; <span class="ruby-ivar">@line</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_int</span>
45:         <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_hash</span>) ; <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_hash</span>.<span class="ruby-identifier">dup</span>
46:         <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>
47:         <span class="ruby-keyword kw">end</span>
48:       <span class="ruby-keyword kw">end</span>
49: 
50:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">&quot;file or block required&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@file</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">block</span>).<span class="ruby-identifier">nil?</span>
51: 
52:       <span class="ruby-comment cmt"># call the initialize_engine method if this is the very first time</span>
53:       <span class="ruby-comment cmt"># an instance of this class has been created.</span>
54:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized?</span>
55:         <span class="ruby-identifier">initialize_engine</span>
56:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">engine_initialized</span> = <span class="ruby-keyword kw">true</span>
57:       <span class="ruby-keyword kw">end</span>
58: 
59:       <span class="ruby-comment cmt"># used to hold compiled template methods</span>
60:       <span class="ruby-ivar">@compiled_method</span> = {}
61: 
62:       <span class="ruby-comment cmt"># used on 1.9 to set the encoding if it is not set elsewhere (like a magic comment)</span>
63:       <span class="ruby-comment cmt"># currently only used if template compiles to ruby</span>
64:       <span class="ruby-ivar">@default_encoding</span> = <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">delete</span> <span class="ruby-value">:default_encoding</span>
65: 
66:       <span class="ruby-comment cmt"># load template data and prepare (uses binread to avoid encoding issues)</span>
67:       <span class="ruby-ivar">@reader</span> = <span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:binread</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@file</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@file</span>) }
68:       <span class="ruby-ivar">@data</span> = <span class="ruby-ivar">@reader</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword kw">self</span>)
69:       <span class="ruby-identifier">prepare</span>
70:     <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="protected-class-method-details" class="method-section section">
			<h3 class="section-header">Protected Class Methods</h3>

		
			<div id="cached-evaluate-method" class="method-detail ">
				<a name="M000112"></a>

				<div class="method-heading">
				
					<span class="method-name">cached_evaluate</span><span
						class="method-args">(scope, locals, &block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Redefine itself to use method compilation the next time:
</p>
					

					
					<div class="method-source-code"
						id="cached-evaluate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/tilt/template.rb, line 138</span>
138:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">cached_evaluate</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
139:         <span class="ruby-identifier">method</span> = <span class="ruby-identifier">compiled_method</span>(<span class="ruby-identifier">locals</span>.<span class="ruby-identifier">keys</span>)
140:         <span class="ruby-identifier">method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">locals</span>, &amp;<span class="ruby-identifier">block</span>)
141:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

